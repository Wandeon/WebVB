# Sprint 2.4 - News Detail Page Design

## Goal

Build the news detail page at `/vijesti/[slug]` displaying individual articles with hero image, rich content, share buttons, related posts, and full SEO metadata.

## Architecture

Server-rendered page using existing `postsRepository.findBySlug()` plus new `getRelatedPosts()` method. Dynamic metadata generation for SEO/OG tags. Two-column layout (content + sidebar) on desktop, single column on mobile.

## Page Structure

```
┌─────────────────────────────────────────────────────────┐
│  ← Povratak na vijesti                                  │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  ┌─────────────────────────────────────────────────┐   │
│  │         HERO (featured image + gradient)         │   │
│  │                                                  │   │
│  │  [Category Badge]     12. siječnja 2026.        │   │
│  │                                                  │   │
│  │  Article Title Here                              │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
│  ┌──────────────────────────┐  ┌──────────────────┐    │
│  │                          │  │ Povezane vijesti │    │
│  │   Article Content        │  │                  │    │
│  │   (prose styling)        │  │ [PostCard]       │    │
│  │                          │  │ [PostCard]       │    │
│  │                          │  │ [PostCard]       │    │
│  │   ─────────────────────  │  │                  │    │
│  │   [Share] [Copy Link]    │  │                  │    │
│  │                          │  └──────────────────┘    │
│  └──────────────────────────┘                          │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

## Components

### ArticleContent
- Wrapper applying Tailwind Typography (`prose`) classes
- Max-width ~65ch for readability
- Handles embedded images in HTML content

### ShareButtons (client component)
- Facebook: opens sharer popup
- Copy Link: clipboard API + "Kopirano!" feedback
- Horizontal layout after article content

### RelatedPosts
- Heading: "Povezane vijesti"
- Vertical stack of up to 3 PostCard components
- Hidden if no related posts found

### ArticleHero
- Featured image background with gradient overlay
- Category badge, formatted date, title
- Fallback to solid color if no image

## Data Flow

1. `page.tsx` receives `params.slug`
2. Fetch post via `postsRepository.findBySlug(slug)`
3. If not found or not published → `notFound()`
4. Fetch related via `postsRepository.getRelatedPosts(post.id, post.category, 3)`
5. Render page with both datasets

## Repository Addition

```typescript
async getRelatedPosts(
  excludeId: string,
  category: string,
  limit: number = 3
): Promise<PostWithAuthor[]> {
  return db.post.findMany({
    where: {
      id: { not: excludeId },
      category,
      publishedAt: { not: null },
    },
    include: { author: { select: authorSelect } },
    orderBy: { publishedAt: 'desc' },
    take: limit,
  });
}
```

## SEO / Metadata

- `generateMetadata` function for dynamic title, description, OG tags
- OG type: `article` with `publishedTime`
- OG image: featured image if present
- Description: excerpt or truncated stripped content
- `generateStaticParams` for build-time generation of published posts
- `revalidate = 60` for ISR

## Error Handling

| Scenario | Behavior |
|----------|----------|
| Slug not found | `notFound()` → 404 page |
| Post is draft | `notFound()` → 404 page |
| No featured image | Solid primary color hero background |
| No excerpt | Generate from stripped/truncated content |
| No related posts | Hide section entirely |
| Very long title | CSS line-clamp in hero |

## Files

| File | Action |
|------|--------|
| `apps/web/app/vijesti/[slug]/page.tsx` | Create |
| `packages/database/src/repositories/posts.ts` | Add `getRelatedPosts` |
| `packages/ui/src/components/article-hero.tsx` | Create |
| `packages/ui/src/components/article-content.tsx` | Create |
| `packages/ui/src/components/share-buttons.tsx` | Create |
| `packages/ui/src/components/related-posts.tsx` | Create |
| `packages/ui/src/index.ts` | Export new components |

## Out of Scope (YAGNI)

- Image lightbox within content (future sprint)
- Comment system
- Print-friendly view
- Reading time estimate
- Author bio section
