# Sprint 2.1 Completion: Public Layout + Nav

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Complete the remaining Sprint 2.1 acceptance criteria: skip-to-content accessibility, active navigation states, and enhanced SEO metadata.

**Architecture:** Add skip-to-content link in layout, enhance NavMenu and MobileDrawer with usePathname() for active states, and create comprehensive metadata configuration using Next.js 15 Metadata API.

**Tech Stack:** Next.js 15, React 19, Tailwind CSS, @repo/ui components

---

## Context

**Already implemented (uncommitted WIP):**
- `apps/web/app/layout.tsx` - Root layout with fonts
- `apps/web/components/layout/header.tsx` - SiteHeader component
- `apps/web/components/layout/footer.tsx` - SiteFooter component
- `apps/web/lib/navigation.ts` - Navigation data structure
- `packages/ui/src/components/nav-menu.tsx` - Desktop navigation
- `packages/ui/src/components/mobile-drawer.tsx` - Mobile navigation
- `packages/ui/src/components/footer.tsx` - Footer component

**Remaining acceptance criteria:**
1. ~~Root layout with local font loading~~ ✅
2. ~~Header component with logo and mobile-responsive navigation~~ ✅
3. ~~Mega-menu or dropdowns for deep hierarchy~~ ✅
4. ~~Footer component with quick links, contacts~~ ✅
5. ~~Mobile drawer navigation~~ ✅
6. SEO basics in layout (metadata base template) ❌
7. Accessibility (skip-to-content, aria-labels) ❌
8. Active state styling for navigation items ❌

---

## Task 1: Add skip-to-content accessibility link

**Files:**
- Modify: `apps/web/app/layout.tsx`

**Step 1: Add skip-to-content link and main content id**

The skip-to-content link should be the first focusable element, visually hidden until focused.

```tsx
// In layout.tsx, add before <SiteHeader />:
<a
  href="#main-content"
  className="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-[100] focus:rounded-md focus:bg-primary-600 focus:px-4 focus:py-2 focus:text-white focus:outline-none"
>
  Preskoči na glavni sadržaj
</a>

// Change <main> to:
<main id="main-content" className="flex-1">
```

**Step 2: Verify**

Run: `cd apps/web && pnpm dev`
- Tab into the page, first focus should reveal "Preskoči na glavni sadržaj"
- Click it or press Enter, page should scroll to main content

**Step 3: Commit**

```bash
git add apps/web/app/layout.tsx
git commit -m "feat(web): add skip-to-content accessibility link"
```

---

## Task 2: Add active state styling to NavMenu

**Files:**
- Modify: `packages/ui/src/components/nav-menu.tsx`

**Step 1: Import usePathname and add active state logic**

```tsx
// Add import at top:
import { usePathname } from 'next/navigation';

// Inside NavMenu component, add:
const pathname = usePathname();

// Helper function to check if path is active:
function isActive(href: string, pathname: string): boolean {
  if (href === '/') return pathname === '/';
  return pathname === href || pathname.startsWith(href + '/');
}

// For dropdown trigger, add active styling:
<DropdownMenuTrigger
  className={cn(
    "flex items-center gap-1 text-sm font-medium transition-colors hover:text-primary-600 focus:outline-none focus:ring-2 focus:ring-primary-500/20 rounded-sm",
    isActive(item.href, pathname)
      ? "text-primary-600 font-semibold"
      : "text-neutral-700"
  )}
>

// For regular links, add active styling:
<Link
  key={item.href}
  href={item.href}
  className={cn(
    "text-sm font-medium transition-colors hover:text-primary-600 focus:outline-none focus:ring-2 focus:ring-primary-500/20 rounded-sm",
    isActive(item.href, pathname)
      ? "text-primary-600 font-semibold"
      : "text-neutral-700"
  )}
>
```

**Step 2: Verify**

Run dev server, navigate to different pages, verify:
- Current page link is highlighted in primary-600
- Parent menu is highlighted when on child page

**Step 3: Commit**

```bash
git add packages/ui/src/components/nav-menu.tsx
git commit -m "feat(ui): add active state styling to NavMenu"
```

---

## Task 3: Add active state styling to MobileDrawer

**Files:**
- Modify: `packages/ui/src/components/mobile-drawer.tsx`

**Step 1: Import usePathname and add active state logic**

```tsx
// Add import at top:
import { usePathname } from 'next/navigation';

// Inside MobileDrawer component, add:
const pathname = usePathname();

// Reuse same helper:
function isActive(href: string, pathname: string): boolean {
  if (href === '/') return pathname === '/';
  return pathname === href || pathname.startsWith(href + '/');
}

// For parent items with children, highlight if any child is active:
function isParentActive(item: NavItem, pathname: string): boolean {
  if (isActive(item.href, pathname)) return true;
  if (item.items) {
    return item.items.some(sub => isActive(sub.href, pathname));
  }
  return false;
}

// Update the section title div:
<div className={cn(
  "font-semibold mb-2",
  isParentActive(item, pathname) ? "text-primary-600" : "text-neutral-900"
)}>
  {item.title}
</div>

// Update sub-item links:
<Link
  key={subItem.href}
  href={subItem.href}
  onClick={() => setOpen(false)}
  className={cn(
    "text-sm font-medium hover:text-primary-600",
    isActive(subItem.href, pathname)
      ? "text-primary-600 font-semibold"
      : "text-neutral-600"
  )}
>

// Update standalone links:
<Link
  href={item.href}
  onClick={() => setOpen(false)}
  className={cn(
    "block px-6 py-4 font-semibold hover:bg-neutral-50 hover:text-primary-600",
    isActive(item.href, pathname)
      ? "text-primary-600 bg-primary-50"
      : "text-neutral-900"
  )}
>
```

**Step 2: Verify**

Run dev server on mobile viewport, open drawer, verify active states.

**Step 3: Commit**

```bash
git add packages/ui/src/components/mobile-drawer.tsx
git commit -m "feat(ui): add active state styling to MobileDrawer"
```

---

## Task 4: Create comprehensive SEO metadata configuration

**Files:**
- Create: `apps/web/app/metadata.ts`
- Modify: `apps/web/app/layout.tsx`

**Step 1: Create metadata configuration file**

```typescript
// apps/web/app/metadata.ts
import type { Metadata } from 'next';

const siteUrl = process.env.NEXT_PUBLIC_SITE_URL || 'https://velikibukovec.hr';

export const siteConfig = {
  name: 'Općina Veliki Bukovec',
  description: 'Službena web stranica Općine Veliki Bukovec - vijesti, dokumenti, događanja i informacije za građane.',
  url: siteUrl,
  ogImage: `${siteUrl}/og-image.jpg`,
  locale: 'hr_HR',
  creator: 'Općina Veliki Bukovec',
};

export const baseMetadata: Metadata = {
  metadataBase: new URL(siteUrl),
  title: {
    default: siteConfig.name,
    template: `%s | ${siteConfig.name}`,
  },
  description: siteConfig.description,
  keywords: [
    'Veliki Bukovec',
    'općina',
    'Varaždinska županija',
    'lokalna samouprava',
    'vijesti',
    'dokumenti',
    'javna nabava',
  ],
  authors: [{ name: siteConfig.creator }],
  creator: siteConfig.creator,
  publisher: siteConfig.creator,
  formatDetection: {
    email: false,
    address: false,
    telephone: false,
  },
  openGraph: {
    type: 'website',
    locale: siteConfig.locale,
    url: siteConfig.url,
    siteName: siteConfig.name,
    title: siteConfig.name,
    description: siteConfig.description,
    images: [
      {
        url: siteConfig.ogImage,
        width: 1200,
        height: 630,
        alt: siteConfig.name,
      },
    ],
  },
  twitter: {
    card: 'summary_large_image',
    title: siteConfig.name,
    description: siteConfig.description,
    images: [siteConfig.ogImage],
  },
  robots: {
    index: true,
    follow: true,
    googleBot: {
      index: true,
      follow: true,
      'max-video-preview': -1,
      'max-image-preview': 'large',
      'max-snippet': -1,
    },
  },
  icons: {
    icon: '/favicon.ico',
    shortcut: '/favicon-16x16.png',
    apple: '/apple-touch-icon.png',
  },
  manifest: '/site.webmanifest',
};
```

**Step 2: Update layout.tsx to use baseMetadata**

```tsx
// apps/web/app/layout.tsx
import { baseMetadata } from './metadata';

// Replace the existing metadata export with:
export const metadata = baseMetadata;
```

**Step 3: Verify**

Run: `cd apps/web && pnpm dev`
- Check page source for meta tags
- Verify og:title, og:description, og:image are present

**Step 4: Commit**

```bash
git add apps/web/app/metadata.ts apps/web/app/layout.tsx
git commit -m "feat(web): add comprehensive SEO metadata configuration"
```

---

## Task 5: Commit existing WIP and update documentation

**Files:**
- All uncommitted WIP files
- Modify: `CHANGELOG.md`
- Modify: `ROADMAP.md`

**Step 1: Stage and commit all Sprint 2.1 files**

```bash
git add apps/web/components/layout/header.tsx
git add apps/web/components/layout/footer.tsx
git add apps/web/lib/navigation.ts
git add packages/ui/src/components/nav-menu.tsx
git add packages/ui/src/components/mobile-drawer.tsx
git add packages/ui/src/components/footer.tsx
git add packages/ui/src/index.ts
git add apps/admin/next-env.d.ts
git add packages/ui/package.json

git commit -m "feat(web): add public site header, footer, and navigation components"
```

**Step 2: Update CHANGELOG.md**

Add under `## Unreleased`:

```markdown
## Sprint 2.1 - Public Layout + Nav (Completed)

### Added
- Public site root layout with Inter and Plus Jakarta Sans fonts
- SiteHeader component with responsive navigation
- NavMenu component with dropdown menus for desktop
- MobileDrawer component with sheet-based mobile navigation
- SiteFooter component with link groups and copyright
- Navigation data structure with full site hierarchy
- Skip-to-content accessibility link
- Active state styling for navigation items
- Comprehensive SEO metadata configuration
- Gate: Mobile menu works, footer renders, no layout shifts
```

**Step 3: Update ROADMAP.md**

Change Sprint 2.1 from `⬜` to `✅` and update Phase 2 progress to 1/12.

**Step 4: Commit documentation**

```bash
git add CHANGELOG.md ROADMAP.md
git commit -m "docs: complete Sprint 2.1 - Public Layout + Nav"
```

---

## Task 6: Final verification

**Step 1: Run type-check and lint**

```bash
pnpm type-check --filter @repo/web
pnpm lint --filter @repo/web
```

**Step 2: Run dev server and verify all criteria**

```bash
cd apps/web && pnpm dev
```

Checklist:
- [ ] Header renders with logo and navigation
- [ ] Dropdown menus work on desktop
- [ ] Mobile drawer opens and closes
- [ ] Footer renders with all link groups
- [ ] Skip-to-content link appears on Tab
- [ ] Active navigation states highlight correctly
- [ ] Page has proper meta tags (check source)
- [ ] No console errors
- [ ] No layout shifts during navigation

**Step 3: Fix any issues, commit if needed**

---

## Summary

This plan completes Sprint 2.1 by:
1. Adding skip-to-content accessibility link
2. Implementing active state styling for NavMenu
3. Implementing active state styling for MobileDrawer
4. Creating comprehensive SEO metadata
5. Committing all existing WIP
6. Updating documentation

Total tasks: 6
Gate: Mobile menu works, footer matches design, no layout shifts
